{"version":3,"file":"FirebaseRecaptchaVerifierModal.js","sourceRoot":"","sources":["../src/FirebaseRecaptchaVerifierModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import { CodedError } from '@unimodules/core';\nimport * as React from 'react';\nimport {\n  StyleSheet,\n  Button,\n  View,\n  SafeAreaView,\n  Text,\n  Modal,\n  ActivityIndicator,\n} from 'react-native';\n\nimport FirebaseRecaptcha from './FirebaseRecaptcha';\nimport { FirebaseAuthApplicationVerifier } from './FirebaseRecaptcha.types';\n\ninterface Props extends Omit<React.ComponentProps<typeof FirebaseRecaptcha>, 'onVerify'> {\n  title?: string;\n  cancelLabel?: string;\n  invisible?: boolean;\n}\ninterface State {\n  token: string;\n  visible: boolean;\n  visibleLoaded: boolean;\n  invisibleLoaded: boolean;\n  invisibleVerify: boolean;\n  resolve?: (token: string) => void;\n  reject?: (error: Error) => void;\n}\n\nexport default class FirebaseRecaptchaVerifierModal extends React.Component<Props, State>\n  implements FirebaseAuthApplicationVerifier {\n  static defaultProps = {\n    title: 'reCAPTCHA',\n    cancelLabel: 'Cancel',\n  };\n\n  state: State = {\n    token: '',\n    visible: false,\n    visibleLoaded: false,\n    invisibleLoaded: false,\n    invisibleVerify: false,\n    resolve: undefined,\n    reject: undefined,\n  };\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    if (!props.invisible && state.invisibleLoaded) {\n      return {\n        invisibleLoaded: false,\n        invisibleVerify: false,\n      };\n    }\n    return null;\n  }\n\n  get type(): string {\n    return 'recaptcha';\n  }\n\n  async verify(): Promise<string> {\n    return new Promise((resolve, reject) => {\n      if (this.props.invisible) {\n        this.setState({\n          token: '',\n          invisibleVerify: true,\n          resolve,\n          reject,\n        });\n      } else {\n        this.setState({\n          token: '',\n          visible: true,\n          visibleLoaded: false,\n          resolve,\n          reject,\n        });\n      }\n    });\n  }\n\n  private onVisibleLoad = () => {\n    this.setState({\n      visibleLoaded: true,\n    });\n  };\n\n  private onInvisibleLoad = () => {\n    this.setState({\n      invisibleLoaded: true,\n    });\n  };\n\n  private onFullChallenge = async () => {\n    this.setState({\n      invisibleVerify: false,\n      visible: true,\n    });\n  };\n\n  private onError = () => {\n    const { reject } = this.state;\n    if (reject) {\n      reject(new CodedError('ERR_FIREBASE_RECAPTCHA_ERROR', 'Failed to load reCAPTCHA'));\n    }\n    this.setState({\n      visible: false,\n      invisibleVerify: false,\n    });\n  };\n\n  private onVerify = (token: string) => {\n    const { resolve } = this.state;\n    if (resolve) {\n      resolve(token);\n    }\n    this.setState({\n      visible: false,\n      invisibleVerify: false,\n    });\n  };\n\n  cancel = () => {\n    const { reject } = this.state;\n    if (reject) {\n      reject(new CodedError('ERR_FIREBASE_RECAPTCHA_CANCEL', 'Cancelled by user'));\n    }\n    this.setState({\n      visible: false,\n    });\n  };\n\n  onDismiss = () => {\n    // onDismiss should be called when the user dismisses the\n    // modal using a swipe gesture. Due to a bug in RN this\n    // unfortunately doesn't work :/\n    //https://github.com/facebook/react-native/issues/26892\n    if (this.state.visible) {\n      this.cancel();\n    }\n  };\n\n  render() {\n    const { title, cancelLabel, invisible, ...otherProps } = this.props;\n    const { visible, visibleLoaded, invisibleLoaded, invisibleVerify } = this.state;\n    return (\n      <View style={styles.container}>\n        {invisible && (\n          <FirebaseRecaptcha\n            {...otherProps}\n            style={styles.invisible}\n            onLoad={this.onInvisibleLoad}\n            onError={this.onError}\n            onVerify={this.onVerify}\n            onFullChallenge={this.onFullChallenge}\n            invisible\n            verify={invisibleLoaded && invisibleVerify}\n          />\n        )}\n        <Modal\n          visible={visible}\n          animationType=\"slide\"\n          presentationStyle=\"pageSheet\"\n          onRequestClose={this.cancel}\n          onDismiss={this.onDismiss}>\n          <SafeAreaView style={styles.modalContainer}>\n            <View style={styles.header}>\n              <Text style={styles.title}>{title}</Text>\n              <View style={styles.cancel}>\n                <Button\n                  title={cancelLabel || FirebaseRecaptchaVerifierModal.defaultProps.cancelLabel}\n                  onPress={this.cancel}\n                />\n              </View>\n            </View>\n            <View style={styles.content}>\n              <FirebaseRecaptcha\n                {...otherProps}\n                style={styles.content}\n                onLoad={this.onVisibleLoad}\n                onError={this.onError}\n                onVerify={this.onVerify}\n              />\n              {!visibleLoaded ? (\n                <View style={styles.loader}>\n                  <ActivityIndicator size=\"large\" />\n                </View>\n              ) : (\n                undefined\n              )}\n            </View>\n          </SafeAreaView>\n        </Modal>\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    width: 0,\n    height: 0,\n  },\n  invisible: {\n    width: 300,\n    height: 300,\n  },\n  modalContainer: {\n    flex: 1,\n  },\n  header: {\n    backgroundColor: '#FBFBFB',\n    height: 44,\n    flexDirection: 'row',\n    justifyContent: 'center',\n    alignItems: 'center',\n    borderBottomColor: '#CECECE',\n    borderBottomWidth: StyleSheet.hairlineWidth,\n  },\n  cancel: {\n    position: 'absolute',\n    left: 8,\n    justifyContent: 'center',\n  },\n  title: {\n    fontWeight: 'bold',\n  },\n  content: {\n    flex: 1,\n  },\n  loader: {\n    ...StyleSheet.absoluteFillObject,\n    paddingTop: 20,\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n  },\n});\n"]}